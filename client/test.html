<html>
<head>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.0.0-alpha1/jquery.min.js"></script>
  <script>
    var apiKey = "AIzaSyD-29IN9uHhfvIVgQw9foPpz31bMc0bGE0";
    var player;
    var dataApiReady = false;
    var iframeApiReady = false;
    var queuedVideo;
    function init()
    {
      gapi.client.setApiKey(apiKey);
      gapi.client.load('youtube', 'v3').then(youtubeDataApiLoaded);
      var tag = document.createElement('script');
      tag.src = 'https://www.youtube.com/iframe_api';
      document.head.appendChild(tag);
      
      setPlaylistList([{name: 'X', id:'XX'}, {name:'Y', id:'YY'}, {name:'Z', id:'ZZ'}]);
    }

    function youtubeDataApiLoaded()
    {
        dataApiReady = true;
    }
    
    function onYouTubeIframeAPIReady()
    {
        iframeApiReady = true;
        player = new YT.Player('player',
        {
            height: '600',
            width: '800',
            videoId: '',
            events: {
                'onReady': function (event) {
                    //console.log(event.target);
                    //event.target.playVideo();
                    //event.target.loadVideoById(item.id.videoId);
                    console.log(player);
                    if(queuedVideo && queuedVideo != "")
                    {
                        event.target.loadVideoById(queuedVideo);
                    }
                  }
            }
        });
    }
    
    function searchVideo()
    {
        if(!dataApiReady){ document.getElementById('searchError').innerHTML = "Youtube Data API is not ready!"; return; }
        var request = gapi.client.youtube.search.list({q: document.getElementById('searchField').value, maxResults: 10, part: 'snippet'});
        request.execute(function(response)
        {
            var vRP = document.getElementById('videoResultParent');
            while (vRP.firstChild)
            {
                vRP.removeChild(vRP.firstChild);
            }
            for(var i in response.items)
            {
                var item = response.items[i];
                console.log(item);
                var row = document.createElement('tr');
                vRP.appendChild(row);
                var cell = document.createElement('td');
                row.appendChild(cell);
                //cell.value = item.id.videoId;
                //cell.addEventListener('click', function(event){ console.log('Load video: ' + event.target.value); player.loadVideoById(event.target.value); });
                var vName = document.createElement('p');
                vName.innerHTML = item.snippet.title;
                //vName.value = item.id.videoId;
                cell.appendChild(vName);
                var vThumb = document.createElement('img');
                //vThumb.value = item.id.videoId;
                vThumb.src = item.snippet.thumbnails.default.url;
                cell.appendChild(vThumb);
                var vAdd = document.createElement('div');
                vAdd.style.cssText = 'width: 50px; height: 50px; background: rgb(230, 230, 230)';
                vAdd.id = item.id.videoId;
                vAdd.addEventListener('click', function(event){ addSongToPlaylist(event.target.id); });
                cell.appendChild(vAdd);
                //var vAuthor = document.createElement('p');
                //vName.innerHTML = item.snippet.title;
                //cell.appendChild(vName);
            }
        });
    }
    
    function addSongToPlaylist(songId)
    {
        
    }
    
    function setPlaylistList (playlistList)
    {
        var playlistListElement = document.getElementById('playlists');
        console.log(playlistListElement.children);
        for(var i = 1; i < playlistListElement.children.length; i = 1)
        {
            playlistListElement.removeChild(playlistListElement.children[i]);
        }
        for(var i = 0; i < playlistList.length; i++)
        {
            var tr = document.createElement('tr');
            playlistListElement.appendChild(tr);
            var td = document.createElement('td');
            tr.appendChild(td);
            td.innerHTML = playlistList[i].name;
            td.value = playlistList[i].id;
            td.addEventListener('click', function(event){ switchToPlayList(event.target.value); });
        }
    }
    
    function switchToPlayList(pId)
    {
        
    }
  </script>
  
  <script src="https://apis.google.com/js/client.js?onload=init"></script>
</head>
<body>
    <table border="0">
        <tbody>
            <tr>
                <td style='width:150px; vertical-align: top; min-height:100%'>
                    <table style='background: rgb(240, 240, 240); width:100%; min-height:100%'>
                        <tbody id='playlists'>
                            <tr>
                                <td>
                                    <input type="button" name="createPlaylist" id="createPlaylist" value="Create Playlist" style='width:100%' />
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </td>
                <td style='width:200px; vertical-align: top; min-height:100%'>
                    <table id='songList' style='background: rgb(220, 220, 220); min-height:100%'>
                        
                    </table>
                </td>
                <td>
                    <table>
                        <tbody>
                            <tr>
                                <td style="width: 50%; vertical-align: top">
                                    <input type="text" name="searchField" id="searchField" value="" />
                                    <input type="button" name="searchButton" id="searchButton" value="Search" onclick='searchVideo()' />
                                    <p id='searchError'></p>
                                    <table id="videoResultTable" border="0">
                                        <tbody id="videoResultParent">
                                        </tbody>
                                    </table>
                                </td>
                                <td style="width: 50%; vertical-align: top">
                                    <div id="player"></div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </td>
            </tr>
        </tbody>
    </table>
</body>
</html>